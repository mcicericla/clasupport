CREATE TABLE categoria_ticket (id INT AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL, descripcion VARCHAR(255), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE curso (id INT AUTO_INCREMENT, nombre VARCHAR(255) NOT NULL, nombre_corto VARCHAR(100), dia VARCHAR(100) NOT NULL, horario TIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE estado_ticket (id INT AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE estado_usuario (id INT AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE nota (id INT AUTO_INCREMENT, fecha_alta DATETIME NOT NULL, texto TEXT NOT NULL, ticket_id INT NOT NULL, INDEX ticket_id_idx (ticket_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE perfil (id INT AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL, fecha_creacion DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE perfil_categoria_ticket (perfil_id INT, categoria_ticket_id INT, PRIMARY KEY(perfil_id, categoria_ticket_id)) ENGINE = INNODB;
CREATE TABLE ticket (id INT AUTO_INCREMENT, descripcion TEXT NOT NULL, fecha_alta DATETIME NOT NULL, fecha_actualizacion DATETIME, fecha_cierre DATETIME, usuario_id INT NOT NULL, estado_ticket_id INT NOT NULL, categoria_ticket_id INT NOT NULL, INDEX usuario_id_idx (usuario_id), INDEX estado_ticket_id_idx (estado_ticket_id), INDEX categoria_ticket_id_idx (categoria_ticket_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE usuario (id INT AUTO_INCREMENT, nombre VARCHAR(255) NOT NULL, apellido VARCHAR(255) NOT NULL, mail VARCHAR(255) NOT NULL, estado_usuario_id INT NOT NULL, perfil_id INT NOT NULL, INDEX estado_usuario_id_idx (estado_usuario_id), INDEX perfil_id_idx (perfil_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE usuario_curso (curso_id INT, usuario_id INT, PRIMARY KEY(curso_id, usuario_id)) ENGINE = INNODB;
ALTER TABLE nota ADD CONSTRAINT nota_ticket_id_ticket_id FOREIGN KEY (ticket_id) REFERENCES ticket(id);
ALTER TABLE perfil_categoria_ticket ADD CONSTRAINT perfil_categoria_ticket_perfil_id_perfil_id FOREIGN KEY (perfil_id) REFERENCES perfil(id);
ALTER TABLE perfil_categoria_ticket ADD CONSTRAINT perfil_categoria_ticket_categoria_ticket_id_categoria_ticket_id FOREIGN KEY (categoria_ticket_id) REFERENCES categoria_ticket(id);
ALTER TABLE ticket ADD CONSTRAINT ticket_usuario_id_usuario_id FOREIGN KEY (usuario_id) REFERENCES usuario(id);
ALTER TABLE ticket ADD CONSTRAINT ticket_estado_ticket_id_estado_ticket_id FOREIGN KEY (estado_ticket_id) REFERENCES estado_ticket(id);
ALTER TABLE ticket ADD CONSTRAINT ticket_categoria_ticket_id_categoria_ticket_id FOREIGN KEY (categoria_ticket_id) REFERENCES categoria_ticket(id);
ALTER TABLE usuario ADD CONSTRAINT usuario_perfil_id_perfil_id FOREIGN KEY (perfil_id) REFERENCES perfil(id);
ALTER TABLE usuario ADD CONSTRAINT usuario_estado_usuario_id_estado_usuario_id FOREIGN KEY (estado_usuario_id) REFERENCES estado_usuario(id);
ALTER TABLE usuario_curso ADD CONSTRAINT usuario_curso_usuario_id_curso_id FOREIGN KEY (usuario_id) REFERENCES curso(id);
ALTER TABLE usuario_curso ADD CONSTRAINT usuario_curso_curso_id_usuario_id FOREIGN KEY (curso_id) REFERENCES usuario(id);
